<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
	<windowclass name="battle_header" merge="join">
		<script>
			function onInit()
				super.onInit();
				
				local node = getDatabaseNode();
				if DB.getValue(node, "generated", 0) == 1 then
					button_refreshcr.onButtonPress();
					DB.setValue(node, "generated", "number", 0);
				end
			end
			function update()
				super.update();

				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				cr.setReadOnly(bReadOnly);
				exp.setReadOnly(bReadOnly);
				button_refreshcr.setVisible(not bReadOnly);
				button_refreshxp.setVisible(not bReadOnly);
			end
		</script>
		<sheetdata>
			<label_recordtype name="recordtype_label" merge="delete" />

			<frame_record name="detailframe">
				<anchored height="40">
					<top parent="name" anchor="bottom" offset="5" />
					<left />
					<right />
				</anchored>
			</frame_record>
			<label name="cr_label">
				<anchored to="detailframe" position="insidetopleft" offset="15,10" height="20" />
				<static textres="cr" />
			</label>
			<basicstring name="cr">
				<anchored to="cr_label" position="righthigh" offset="10,0" width="20" height="20" />
				<tabtarget next="exp" prev="name" />
				<description textres="cr" />
				<center />
			</basicstring>
			<button_enc_refreshcr name="button_refreshcr" />

			<basicnumber name="exp">
				<anchored to="detailframe" position="insidetopright" offset="40,10" width="70" height="20" />
				<tabtarget next="npcs" prev="cr" />
				<description textres="xp" />
			</basicnumber>
			<label name="exp_label">
				<anchored to="exp" position="lefthigh" offset="10,0" />
				<static textres="xp" />
			</label>
			<button_enc_refreshxp name="button_refreshxp" />
		</sheetdata>
	</windowclass>
</root>
